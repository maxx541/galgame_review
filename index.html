<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galgame 年度回顧產生器</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React, ReactDOM & Babel for JSX Support -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- HTML2Canvas (保留作為依賴，但不使用導出功能) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- OpenCC JS (用於簡轉繁) -->
    <script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        /* 確保斷行美觀 */
        .overflow-wrap-anywhere {
            overflow-wrap: anywhere;
            word-break: break-word;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 工具函式 ---
        const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);
        
        const STANDARD_FORMAT = `遊戲：白色相簿2
日期：2025-05-20
時長：80小時
評分：5
標籤：經典, 虐心

遊戲：命運石之門
日期：2025-06-15
時長：40小時
評分：5
標籤：科幻, 燒腦`;

        // --- 圖示組件 ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const Plus = (props) => <IconBase {...props}><path d="M5 12h14M12 5v14"/></IconBase>;
        const Star = (props) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const Gamepad2 = (props) => <IconBase {...props}><line x1="6" x2="10" y1="12" y2="12"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="15" x2="15.01" y1="13" y2="13"/><line x1="18" x2="18.01" y1="11" y2="11"/><rect x="2" y="6" width="20" height="12" rx="2"/></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const Loader2 = (props) => <IconBase {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>;
        const Camera = (props) => <IconBase {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"/></IconBase>;
        const Copy = (props) => <IconBase {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></IconBase>;
        const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/></IconBase>;

        // --- 海報頁面組件 (生成模式) ---
        const PosterPage = ({ games, pageIndex, totalPages, id }) => {
            return (
                <div id={id} className="bg-white shadow-2xl relative overflow-hidden flex flex-col p-10 text-slate-900 border border-slate-100" style={{ height: '740px', width: '420px', minWidth: '420px', minHeight: '740px', boxSizing: 'border-box' }}>
                    <div className="absolute inset-0 bg-gradient-to-br from-slate-50 via-white to-slate-100 opacity-90" />
                    
                    {/* Header Section - 靠左對齊 */}
                    <div className="relative z-10 text-left mb-8 border-l-[6px] border-slate-900 pl-6 py-2 flex-shrink-0">
                        <h2 className="text-4xl font-black tracking-tighter text-slate-950 italic" style={{ lineHeight: '1' }}>2025</h2>
                        <h2 className="text-xl font-bold tracking-widest text-slate-800 mt-2 uppercase">GALGAME 回顧</h2>
                    </div>

                    <div className="relative z-10 flex-1 flex flex-col justify-around overflow-hidden">
                        {/* 時間軸線 */}
                        <div className="absolute left-[8px] top-2 bottom-6 w-[2px] bg-slate-200 z-0" />
                        
                        {games.map((game) => (
                            <div key={game.id} className="relative flex gap-4 z-10 h-1/4 items-start">
                                {/* 時間軸圓點 - pt-[6px] 確保圓點中心對齊日期框文字中心 */}
                                <div className="flex-shrink-0 w-4 flex justify-center pt-[6px]">
                                    <div className="w-3.5 h-3.5 rounded-full border-[3px] border-slate-900 bg-white relative z-20" />
                                </div>

                                <div className="flex-1 min-w-0 flex flex-col items-start text-left px-0">
                                    {/* 日期標籤 - 靠左 */}
                                    <div className="flex justify-start mb-2 w-full">
                                        <span className="inline-block bg-slate-950 text-white text-[10px] font-black tracking-widest px-2 py-0.5 rounded shadow-sm leading-tight font-mono uppercase">
                                            {game.date || 'DATE TBD'}
                                        </span>
                                    </div>
                                    
                                    {/* 遊戲標題 - 靠左 */}
                                    <h3 className="font-bold text-xl text-slate-900 break-words leading-tight tracking-tight mb-1.5 overflow-wrap-anywhere line-clamp-2 w-full">
                                        {game.title}
                                    </h3>

                                    {/* 評分與時間 - 靠左 */}
                                    <div className="flex items-center justify-start gap-3 text-[10px] text-slate-500 font-bold uppercase mb-2">
                                        <span className="flex items-center gap-1">
                                            <Clock size={11} className="text-slate-400" /> 
                                            <span className="italic">{game.duration || '--'}</span>
                                        </span>
                                        <div className="flex gap-0.5">
                                            {[...Array(5)].map((_, i) => (
                                                <Star key={i} size={11} className={i < game.rating ? "fill-yellow-400 text-yellow-400" : "fill-slate-200 text-slate-200"} />
                                            ))}
                                        </div>
                                    </div>

                                    {/* 標籤 - 靠左佈局：外框隨文字變長，支援換行 */}
                                    {game.tags && (
                                        <div className="flex flex-wrap justify-start gap-x-2 gap-y-1.5 w-full">
                                            {game.tags.split(/[,，]/).filter(t => t.trim()).slice(0, 6).map((t, i) => (
                                                <span key={i} className="inline-block border border-slate-900 text-slate-900 bg-white px-2 py-0.5 rounded text-[9px] font-bold italic shadow-[1px_1px_0px_rgba(15,23,42,0.1)] break-words max-w-full">
                                                    #{t.trim()}
                                                </span>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* 封面圖 */}
                                <div className="flex-shrink-0 pt-1">
                                    {/* 修改：移除旋轉效果，回歸正向顯示，這能最直接地避免鋸齒問題 */}
                                    <div 
                                        className="w-16 aspect-[3/4] bg-slate-100 rounded shadow-md border-[2px] border-white overflow-hidden relative" 
                                    >
                                        {game.coverUrl ? (
                                            <img 
                                                src={game.coverUrl} 
                                                className="w-full h-full object-cover" 
                                                alt="" 
                                                style={{ imageRendering: 'high-quality' }}
                                                onError={(e) => { e.target.src = "https://api.dicebear.com/7.x/identicon/svg?seed=failed"; }}
                                            />
                                        ) : (
                                            <div className="w-full h-full bg-slate-200" />
                                        )}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {/* Footer */}
                    <div className="relative z-10 mt-4 pt-4 flex justify-between items-center border-t border-slate-900/10 flex-shrink-0">
                        <p className="text-[8px] font-bold text-slate-300 tracking-widest uppercase italic">Memories of 2025</p>
                        <div className="flex items-center gap-2">
                             <p className="text-[9px] font-bold text-slate-400 tracking-tighter uppercase">{pageIndex + 1} / {totalPages}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 編輯組件 ---
        const Editor = ({ games, onUpdateGame, onRemoveGame, onAddGame, onSearchCover, onEnterPreview }) => {
            return (
                <div className="space-y-4 max-w-3xl mx-auto">
                    {games.map((game) => (
                        <div key={game.id} className="bg-white rounded-xl p-4 md:p-5 shadow-sm border border-slate-200 flex flex-col md:flex-row gap-4 md:gap-6 relative group transition-all hover:shadow-md text-left">
                            <div onClick={() => onSearchCover(game.id, game.title)} className="w-full md:w-32 h-44 bg-white rounded-lg flex-shrink-0 cursor-pointer overflow-hidden border-2 border-dashed border-slate-300 hover:border-slate-800 flex flex-col items-center justify-center group relative transition-colors">
                                {game.coverUrl ? (
                                    <>
                                        <img src={game.coverUrl} className="w-full h-full object-cover" alt="cover" />
                                        <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity">
                                            <Search className="text-white w-6 h-6" />
                                        </div>
                                    </>
                                ) : (
                                    <div className="text-center p-2">
                                        <Search className="text-slate-300 mx-auto mb-1 group-hover:text-slate-500 transition-colors" />
                                        <span className="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">搜尋封面</span>
                                    </div>
                                )}
                            </div>
                            <div className="flex-1 grid grid-cols-1 gap-4">
                                <div className="space-y-3">
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block">遊戲名稱</label>
                                        <input type="text" value={game.title} onChange={(e) => onUpdateGame(game.id, 'title', e.target.value)} className="w-full px-3 py-2 border border-slate-200 rounded-lg bg-white focus:ring-2 focus:ring-slate-800 outline-none font-bold text-slate-800 placeholder-slate-300" placeholder="請輸入遊戲名稱" />
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                        <div>
                                            <label className="text-[10px] font-bold text-slate-400 mb-1 block">日期</label>
                                            <input type="date" value={game.date} onChange={(e) => onUpdateGame(game.id, 'date', e.target.value)} className="w-full px-2 py-2 border border-slate-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-slate-800 outline-none" />
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-bold text-slate-400 mb-1 block">時長</label>
                                            <input type="text" value={game.duration} onChange={(e) => onUpdateGame(game.id, 'duration', e.target.value)} placeholder="40hr" className="w-full px-2 py-2 border border-slate-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-slate-800 outline-none" />
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-bold text-slate-400 mb-1 block">標籤 (以逗號分隔)</label>
                                            <input type="text" value={game.tags} onChange={(e) => onUpdateGame(game.id, 'tags', e.target.value)} placeholder="校園, 催淚" className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-white focus:ring-2 focus:ring-slate-800 outline-none" />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-400 mb-1 block">評分</label>
                                        <div className="flex gap-1">
                                            {[1, 2, 3, 4, 5].map(s => (
                                                <button key={s} onClick={() => onUpdateGame(game.id, 'rating', s)} className="focus:outline-none transform active:scale-110 transition-transform">
                                                    <Star className={`w-6 h-6 ${game.rating >= s ? 'fill-yellow-400 text-yellow-400' : 'text-slate-200'}`} />
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button onClick={() => onRemoveGame(game.id)} className="absolute top-2 right-2 text-slate-300 hover:text-red-500 p-2 transition-colors rounded-full hover:bg-red-50"><X size={18} /></button>
                        </div>
                    ))}
                    <button onClick={onAddGame} className="w-full py-4 border-2 border-dashed border-slate-300 rounded-xl text-slate-400 flex items-center justify-center gap-2 bg-white/50 hover:bg-white hover:border-slate-400 hover:text-slate-600 mb-6 transition-all font-bold">
                        <Plus size={20} /> 新增一筆紀錄
                    </button>
                    <div className="sticky bottom-6 z-40 px-2">
                        <button onClick={onEnterPreview} disabled={games.filter(g => g.title).length === 0} className="w-full py-4 bg-slate-900 text-white font-bold rounded-xl shadow-xl shadow-slate-900/20 flex items-center justify-center gap-2 transform active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            <Camera size={20} /> 進入生成模式 ({games.filter(g => g.title).length})
                        </button>
                    </div>
                </div>
            );
        };

        // --- 主應用組件 ---
        const App = () => {
            const [games, setGames] = useState([]);
            const [previewMode, setPreviewMode] = useState(false);
            const [searchModal, setSearchModal] = useState({ isOpen: false, gameId: null, query: '', results: [], loading: false });
            const [importModalOpen, setImportModalOpen] = useState(false);
            const [inputText, setInputText] = useState('');
            const [copyFeedback, setCopyFeedback] = useState(false);
            
            // 初始化 OpenCC 轉換器 (CN -> TW)
            const converter = useMemo(() => {
                if (typeof OpenCC !== 'undefined') {
                    // from 'cn' (Simplified) to 'tw' (Traditional Taiwan)
                    return OpenCC.Converter({ from: 'cn', to: 'tw' });
                }
                return null;
            }, []);

            // 每張頁面放置 4 個遊戲
            const ITEMS_PER_PAGE = 4;

            useEffect(() => {
                if (games.length === 0) addEmptyGame();
            }, []);

            const addEmptyGame = () => {
                setGames(prev => [...prev, { id: generateId(), title: '', date: '', duration: '', rating: 5, tags: '', coverUrl: null }]);
            };

            const updateGame = (id, field, value) => {
                setGames(games.map(g => g.id === id ? { ...g, [field]: value } : g));
            };

            const removeGame = (id) => {
                setGames(games.filter(g => g.id !== id));
            };

            const copyExample = () => {
                const textArea = document.createElement("textarea");
                textArea.value = STANDARD_FORMAT;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                textArea.style.top = "0";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        setCopyFeedback(true);
                        setTimeout(() => setCopyFeedback(false), 2000);
                    }
                } catch (err) { console.error('複製失敗', err); }
                document.body.removeChild(textArea);
            };

            const parseAndAddGames = () => {
                if (!inputText.trim()) return;
                const normalizedText = inputText.replace(/\r\n/g, '\n');
                const blocks = normalizedText.split(/\n\s*\n|(?=\n(?:遊戲|名稱|Title|Game)[:：])/);
                const newItems = [];
                blocks.forEach(block => {
                    const lines = block.split('\n').map(l => l.trim()).filter(l => l);
                    if (lines.length === 0) return;
                    let item = { id: generateId(), title: '', date: '', duration: '', rating: 5, tags: '', coverUrl: null };
                    let foundData = false;
                    lines.forEach(line => {
                        const titleMatch = line.match(/^(?:遊戲|名稱|Title|Game)[:：]\s*(.*)/i);
                        const dateMatch = line.match(/^(?:日期|時間|Date|遊玩日期)[:：]\s*(\d{4}[-/年]\d{1,2}[-/月]\d{1,2}日?)/);
                        const durationMatch = line.match(/^(?:時長|遊玩時間|Duration)[:：]\s*(.*)/i);
                        const ratingMatch = line.match(/^(?:評分|分數|Rating)[:：]\s*(\d)/);
                        const tagsMatch = line.match(/^(?:標籤|關鍵字|Tags)[:：]\s*(.*)/i);
                        if (titleMatch) { item.title = titleMatch[1].trim(); foundData = true; }
                        else if (dateMatch) { 
                            let d = dateMatch[1].replace(/年|月/g, '-').replace(/日/g, '').replace(/\//g, '-');
                            const parts = d.split('-');
                            if (parts.length === 3) item.date = `${parts[0]}-${parts[1].padStart(2, '0')}-${parts[2].padStart(2, '0')}`;
                            else item.date = d;
                            foundData = true; 
                        }
                        else if (durationMatch) { item.duration = durationMatch[1].trim(); foundData = true; }
                        else if (ratingMatch) { item.rating = parseInt(ratingMatch[1]); foundData = true; }
                        else if (tagsMatch) { item.tags = tagsMatch[1].trim(); foundData = true; }
                        else if (!item.title && !line.includes('：') && !line.includes(':') && line.length < 50) { item.title = line; foundData = true; }
                    });
                    if (foundData && item.title) newItems.push(item);
                });
                if (newItems.length > 0) {
                    setGames(prev => (prev.length === 1 && !prev[0].title ? newItems : [...prev, ...newItems]));
                    setInputText('');
                    setImportModalOpen(false);
                }
            };

            const searchVNDB = async (id, title) => {
                if (!title) return;
                setSearchModal({ isOpen: true, gameId: id, query: title, results: [], loading: true });
                try {
                    // 更新 API 請求，加入 titles 相關欄位以獲取多語言標題
                    const response = await fetch('https://api.vndb.org/kana/vn', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            filters: ["search", "=", title],
                            fields: "title, image.url, released, titles.title, titles.lang",
                            results: 12
                        })
                    });
                    const data = await response.json();
                    
                    const results = (data.results || []).map(item => {
                        // 標題優先順序邏輯：繁體 -> 簡體 -> 日文 -> 預設(英文/原標題)
                        let preferredTitle = item.title;
                        
                        if (item.titles && item.titles.length > 0) {
                            const findTitle = (lang) => item.titles.find(t => t.lang === lang);
                            
                            const zhHant = findTitle('zh-Hant');
                            const zhHans = findTitle('zh-Hans');
                            const ja = findTitle('ja');
                            
                            if (zhHant) {
                                preferredTitle = zhHant.title;
                            } else if (zhHans) {
                                // 若選中簡體中文，且 converter 存在，則進行轉換
                                if (converter) {
                                    try {
                                        preferredTitle = converter(zhHans.title);
                                    } catch (e) {
                                        console.warn("OpenCC conversion failed:", e);
                                        preferredTitle = zhHans.title;
                                    }
                                } else {
                                    preferredTitle = zhHans.title;
                                }
                            } else if (ja) {
                                preferredTitle = ja.title;
                            }
                        }

                        return {
                            originalTitle: item.title,
                            preferredTitle: preferredTitle,
                            url: item.image?.url || `https://api.dicebear.com/7.x/identicon/svg?seed=${item.id}`,
                            released: item.released
                        };
                    }).filter(item => item.url);
                    
                    setSearchModal(prev => ({ ...prev, results, loading: false }));
                } catch (error) {
                    console.error("VNDB Search Error:", error);
                    // 錯誤時的 Fallback
                    setSearchModal(prev => ({ 
                        ...prev, 
                        results: [{ 
                            originalTitle: title, 
                            preferredTitle: title, 
                            url: `https://api.dicebear.com/7.x/identicon/svg?seed=${title}`, 
                            released: '2025-01-01' 
                        }], 
                        loading: false 
                    }));
                }
            };

            const validGames = games.filter(g => g.title);
            const gamePages = useMemo(() => {
                const p = [];
                for (let i = 0; i < validGames.length; i += ITEMS_PER_PAGE) p.push(validGames.slice(i, i + ITEMS_PER_PAGE));
                return p;
            }, [validGames]);

            const closeSearchModal = () => setSearchModal({ ...searchModal, isOpen: false });

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-20">
                    <div className="max-w-4xl mx-auto px-4 py-8">
                        <header className="mb-8 text-center">
                            <h1 className="text-2xl md:text-3xl font-black text-slate-900 mb-2 flex items-center justify-center gap-2 tracking-tight">
                                <Gamepad2 className="w-8 h-8" /> GALGAME REVIEW
                            </h1>
                            {!previewMode && (
                                <div className="mt-6 flex justify-center">
                                    <button onClick={() => setImportModalOpen(true)} className="flex items-center gap-2 px-6 py-2.5 bg-slate-800 rounded-full text-sm font-bold text-white shadow-lg shadow-slate-200 active:scale-95 transition-all hover:bg-slate-700">
                                        <Sparkles size={16} /> 快速貼上文字
                                    </button>
                                </div>
                            )}
                        </header>

                        {!previewMode ? (
                            <Editor games={games} onUpdateGame={updateGame} onRemoveGame={removeGame} onAddGame={addEmptyGame} onSearchCover={searchVNDB} onEnterPreview={() => { setPreviewMode(true); window.scrollTo(0,0); }} />
                        ) : (
                            <div className="space-y-12 flex flex-col items-center pb-32">
                                {gamePages.map((pageGames, pageIndex) => (
                                    <div key={pageIndex} className="animate-in">
                                        <PosterPage id={`poster-page-${pageIndex}`} games={pageGames} pageIndex={pageIndex} totalPages={gamePages.length} />
                                    </div>
                                ))}
                                <div className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-slate-200 p-4 md:p-6 z-[60] flex items-center justify-center shadow-2xl">
                                    <button 
                                        onClick={() => { setPreviewMode(false); window.scrollTo(0,0); }} 
                                        className="px-12 py-4 bg-slate-950 text-white rounded-full font-black shadow-xl active:scale-95 transition-all"
                                    >
                                        返回編輯
                                    </button>
                                </div>
                            </div>
                        )}

                        {importModalOpen && (
                            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in">
                                <div className="bg-white rounded-2xl w-full max-w-xl shadow-2xl overflow-hidden flex flex-col max-h-[92vh]">
                                    <div className="p-4 border-b flex items-center justify-between">
                                        <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2"><Sparkles size={18} /> 快速辨識文字</h3>
                                        <button onClick={() => setImportModalOpen(false)} className="p-2 hover:bg-slate-100 rounded-full"><X size={24} className="text-slate-500" /></button>
                                    </div>
                                    <div className="p-6 space-y-4 overflow-y-auto text-left">
                                        <div className="flex items-center justify-between">
                                            <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">請依照格式貼上</span>
                                            <button onClick={copyExample} className="text-xs text-slate-800 font-bold flex items-center gap-1 bg-slate-100 px-2 py-1 rounded hover:bg-slate-200 transition-colors">
                                                {copyFeedback ? <Check size={12} className="text-green-600" /> : <Copy size={12} />} {copyFeedback ? '已複製' : '複製範例'}
                                            </button>
                                        </div>
                                        <textarea value={inputText} onChange={(e) => setInputText(e.target.value)} placeholder={"遊戲：名稱\n日期：2025-01-01..."} className="w-full min-h-[250px] p-4 bg-white border border-slate-200 rounded-xl text-sm outline-none resize-none font-mono focus:ring-2 focus:ring-slate-900 transition-all" />
                                    </div>
                                    <div className="p-4 bg-slate-50 border-t flex gap-3">
                                        <button onClick={() => setImportModalOpen(false)} className="flex-1 py-4 bg-white border border-slate-200 text-slate-600 font-bold rounded-lg hover:bg-slate-50 transition-colors">取消</button>
                                        <button onClick={parseAndAddGames} className="flex-1 py-4 bg-slate-900 text-white font-bold rounded-lg active:scale-95 transition-all hover:bg-slate-800">立即辨識</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {searchModal.isOpen && (
                            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in">
                                <div className="bg-white rounded-2xl w-full max-w-2xl max-h-[85vh] flex flex-col shadow-2xl overflow-hidden">
                                    <div className="p-4 border-b flex items-center justify-between">
                                        <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2"><Search size={18} /> 選擇封面圖 ({searchModal.query})</h3>
                                        <button onClick={closeSearchModal} className="p-2 hover:bg-slate-100 rounded-full"><X size={24} className="text-slate-500" /></button>
                                    </div>
                                    <div className="p-6 overflow-y-auto bg-slate-50 hide-scrollbar text-left">
                                        {searchModal.loading ? (
                                            <div className="flex flex-col items-center justify-center text-slate-400 py-16"><Loader2 className="animate-spin mb-4 w-10 h-10 text-slate-600" /><span className="font-bold">搜尋 VNDB 中...</span></div>
                                        ) : (
                                            <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                                {searchModal.results.map((item, i) => (
                                                    <div key={i} onClick={() => { setGames(games.map(g => g.id === searchModal.gameId ? { ...g, title: item.preferredTitle, coverUrl: item.url, date: g.date || item.released || '' } : g)); closeSearchModal(); }} className="group cursor-pointer active:scale-95 transition-transform">
                                                        <div className="aspect-[3/4] rounded-lg overflow-hidden border-4 border-transparent hover:border-slate-800 shadow-md bg-white relative"><img src={item.url} alt="" className="w-full h-full object-cover" /></div>
                                                        <p className="text-[10px] font-bold text-slate-700 mt-2 line-clamp-2 text-center">{item.preferredTitle}</p>
                                                        {item.preferredTitle !== item.originalTitle && (
                                                            <p className="text-[8px] text-slate-400 text-center line-clamp-1">{item.originalTitle}</p>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>